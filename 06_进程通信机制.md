---
title: 进程通信机制
author: Allwayso
update: 2025-12-22
status: Completed
---

---

## 进程通信的需求

### 进程间的隔离性

为了维持进程的独立和安全，各个进程的物理地址是相互分隔的，也就意味着不能访问别的进程的内存

### 进程间的协作性

进程之间在以下情况中需要协作：

1. 数据传输与共享 进程B需要进程A的数据、状态等信息作为输入/两进程有大量信息需要共享访问
2. 同步与互斥 进程同步与互斥机制需要通过信号量等机制维护，这也是进程通信的一部分
3. 消息通知 一个进程需要异步的通知另一进程发生了一个事件/内核进程需要与用户端进程通信

### 通信的必要性

需要通过进程间通信，在保证隔离性的前提下，实现进程间协作

---

## 进程通信方式

### 管道：

定义：一个由操作系统内核维护的、固定大小的循环缓冲区，遵循 FIFO（先入先出）原则

匿名管道（pipe）：最简单的IPC机制，父进程作为写端，子进程作为读端

命名管道（FIFO）：创建一个缓冲区，可以支持多读多写

### 信号：

定义：信号是一个异步的整数值，本身并不携带数据，生命周期为产生-递送-执行

产生：用户按下控制键，系统调用，硬件异常，时钟到期等，此时信号被写入进程的信号位图中

检查：当进程从内核态进入用户态或准备重新调度时，内核检查该进程的信号位图

执行：如果被屏蔽，就进入待执行队列；否则采取默认/忽略/自定义捕获

### 消息队列

定义：一个用链式有限队列，传输单位是结构化的信息

发送：发送进程构造一个信息，通过系统调用将其加在消息队列队尾（与管道类似，满时阻塞）

接受：与管道不同，读端并不一定在队首，可以指定具有某一特点的信息（空时阻塞）

### 共享内存

定义：一个零拷贝、无同步机制、信息格式任意的内存空间

创建：一个进程通过系统调用，在RAM中创建一个共享内存段

映射：需要通信的进程通过系统调用，将该物理地址映射到自己的虚拟地址空间中

读写：一旦映射完成，可以对共享内存做任意读写操作，共享内存本身没有同步机制

### 嵌套字

定义：跨网络的双向通信，是一种高度抽象封装的通信模型

### 五种通信方式的特点和优缺点

| **机制**                      | **类型**   | **通信模式** | **适用进程关系**         | **主要优点**                                        | **主要缺点 / 限制**                          |
| --------------------------- | -------- | -------- | ------------------ | ----------------------------------------------- | -------------------------------------- |
| **1. 匿名管道 (Pipe)**          | **流式**   | 单向 (半双工) | **有亲缘关系**（父子、兄弟进程） | 简单易用，系统开销低，传输可靠。                                | **只能用于有亲缘关系进程**；**只能单向通信**；传输无格式字节流。   |
| **2. 命名管道 (FIFO)**          | **流式**   | 单向 (半双工) | **无亲缘关系**（任意进程）    | 克服了匿名管道的亲缘关系限制；有文件路径标识，易于访问。                    | 仍是**单向通信**；生命周期需手动管理；传输无格式字节流。         |
| **3. 信号 (Signal)**          | **控制**   | 异步通知     | 任意                 | **最轻量级**，适用于异步事件通知和进程控制。                        | **不传输数据**（只传递事件类型）；信号不排队，可能丢失（不可靠）。    |
| **4. 消息队列 (Message Queue)** | **报文**   | 异步、灵活    | 任意                 | **结构化**通信（消息有边界和类型）；可实现**选择性接收**；天然支持生产者-消费者模型。 | **速度较慢**（涉及数据拷贝）；队列大小有限制；接口相对复杂。       |
| **5. 共享内存 (Shared Memory)** | **存储**   | 直接存取     | 任意                 | **速度最快**（零拷贝），效率最高，适合传输大数据。                     | **必须依赖外部同步机制**（如信号量/互斥锁）来保证数据一致性；编程复杂。 |
| **6. 套接字 (Socket)**         | **网络/流** | 全双工      | 任意（本地/远程）          | **最通用、最灵活**；唯一支持**跨网络通信**；支持可靠（TCP）或不可靠（UDP）传输。 | 相对复杂，涉及网络协议栈，**本地通信开销较大**（相比共享内存）。     |
